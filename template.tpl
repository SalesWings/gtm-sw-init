___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "SalesWings",
  "categories": [
    "SALES",
    "PERSONALIZATION",
    "ATTRIBUTION"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "SD Technologies SA",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Track and leverage your leads\u0027 digital interactions with your business in a clever way.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pid",
    "displayName": "Project ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true,
    "valueHint": "123e4567-e89b-12d3-a456-426655440000"
  },
  {
    "type": "TEXT",
    "name": "apiurl",
    "displayName": "Tracking API URL",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "trackpageview",
    "displayName": "Track Page Views",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "trackhashchange",
        "checkboxText": "Track Hash Change",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "tracklocationchange",
        "checkboxText": "Track Location Change",
        "simpleValueType": true,
        "defaultValue": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackforms",
    "displayName": "Track Forms",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "trackformsenabled",
        "checkboxText": "Enabled",
        "simpleValueType": true,
        "defaultValue": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "interactions",
    "displayName": "Interactions",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "interactionsenabled",
        "checkboxText": "Enabled",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "TEXT",
        "name": "interactionsapiurl",
        "displayName": "API URL",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "cookie",
    "displayName": "Cookie",
    "subParams": [
      {
        "type": "TEXT",
        "name": "cookiename",
        "simpleValueType": true,
        "defaultValue": "sw",
        "displayName": "Name"
      },
      {
        "type": "TEXT",
        "name": "cookiedomain",
        "displayName": "Domain",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "cookiepath",
        "displayName": "Path",
        "simpleValueType": true,
        "defaultValue": "/"
      }
    ],
    "groupStyle": "ZIPPY_CLOSED"
  },
  {
    "type": "GROUP",
    "name": "iframebinding",
    "displayName": "Frame Binding",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "framebindingmode",
        "displayName": "Mode",
        "selectItems": [
          {
            "value": "host",
            "displayValue": "Host"
          },
          {
            "value": "guest",
            "displayValue": "Guest"
          },
          {
            "value": "auto",
            "displayValue": "Auto"
          }
        ],
        "simpleValueType": true,
        "notSetText": "Standalone"
      },
      {
        "type": "TEXT",
        "name": "selector",
        "displayName": "CSS selector",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "framebindingmode",
            "paramValue": "host",
            "type": "EQUALS"
          }
        ],
        "defaultValue": "iframe"
      },
      {
        "type": "TEXT",
        "name": "trusteddomain",
        "displayName": "Trusted Domain",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "framebindingmode",
            "paramValue": "guest",
            "type": "EQUALS"
          },
          {
            "paramName": "framebindingmode",
            "paramValue": "auto",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advanced",
    "displayName": "Advanced",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "debug",
        "checkboxText": "Debug",
        "simpleValueType": true
      },
      {
        "type": "CHECKBOX",
        "name": "beta",
        "checkboxText": "Beta",
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "transport",
        "displayName": "Transport",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "post",
            "displayValue": "Post"
          },
          {
            "value": "beacon",
            "displayValue": "Beacon"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "post"
      },
      {
        "type": "SELECT",
        "name": "hashEmail",
        "displayName": "Email hash function",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "plain",
            "displayValue": "Default"
          },
          {
            "value": "sha256",
            "displayValue": "SHA256"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "plain"
      },
      {
        "type": "SELECT",
        "name": "trackformsmode",
        "displayName": "Form Tracking Mode",
        "selectItems": [
          {
            "value": "submit",
            "displayValue": "Submit"
          },
          {
            "value": "blur",
            "displayValue": "Blur"
          },
          {
            "value": "legacy",
            "displayValue": "Legacy"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "submit"
      },
      {
        "type": "TEXT",
        "name": "trackformsdelay",
        "displayName": "Form Tracking Delay",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ],
        "valueHint": "0"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const createArgumentsQueue = require('createArgumentsQueue');
let ws_script = data.beta?
    'https://s.saleswingsapp.com/sw.beta.min.js':
    'https://s.saleswingsapp.com/sw.prod.min.js';

injectScript(ws_script,data.gtmOnSuccess, data.gtmOnFailure,'');

const sw = createArgumentsQueue('sw', 'sw.q');

sw('init', {
  pid: data.pid,
  apiUrl: data.apiurl?data.apiurl:undefined,
  debug: data.debug,
  transport: data.transport,
  clientSideCookie:'true',
  cookieName:data.cookiename,
  cookieDomain: data.cookie,
  cookiePath: data.cookiepath,
  binding:data.framebindingmode?{
    mode:data.framebindingmode,
    selector:data.selector,
    trustedDomains:data.trusteddomain}:
undefined,
  emailFormat:data.hashEmail
}  );

if(data.trackhashchange || data.tracklocationchange){
  sw('trackPageviews',{  
    trackHashChange: data.trackhashchange,
    trackLocationChange: data.tracklocationchange}
    ); 
}

if(data.trackformsenabled){
  sw('trackForms', {
    mode: data.trackformsmode,
    delay: data.trackformsdelay});
}

if(data.interactionsenabled){
  sw('enablePopups', {
    apiUrl: data.interactionsapiurl || undefined
  });
}
log(data);
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sw"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sw.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.saleswingsapp.com/sw.prod.min.js"
              },
              {
                "type": 1,
                "string": "https://s.saleswingsapp.com/sw.beta.min.js"
              },
              {
                "type": 1,
                "string": "https://s.saleswingsapp.com/sw.dev.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: beta
  code: |-
    const log = require('logToConsole');
    const mockData = {
      pid:'4723ad53-8a19-43ab-9b0a-e6d3f1fbb2e4',
      debug:!0,
      transport:'beacon',
      clientSideCookie:'true',
      beta:true
      // Mocked field values
    };

    log(mockData);

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: prod
  code: |-
    const mockData = {
      pid:'4723ad53-8a19-43ab-9b0a-e6d3f1fbb2e4',
      debug:!0,
      transport:'post',
      clientSideCookie:'true',
      beta:false
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 8/18/2020, 5:41:32 PM


